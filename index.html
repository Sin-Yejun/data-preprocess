<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Answer Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1e21; }
        h1 { text-align: center; color: #1c1e21; padding: 20px 0; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .tab { overflow: hidden; border-bottom: 1px solid #ccc; background-color: #fff; }
        .tab button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 17px; border-bottom: 3px solid transparent; }
        .tab button:hover { background-color: #f1f1f1; }
        .tab button.active { border-bottom: 3px solid #0056b3; color: #0056b3; font-weight: bold; }
        .category-tab { margin-top: 10px; margin-bottom: 20px; }
        .tabcontent { display: none; padding: 20px 0; border-top: none; }
        .question-block { background-color: #fff; margin-bottom: 25px; border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.12); }
        .question-title { font-size: 1.5em; color: #0056b3; margin-top: 0; line-height: 1.4; }
        .answers-container { display: flex; flex-direction: row; gap: 20px; justify-content: space-between; }
        .answer-card { border: 1px solid #e1e1e1; border-radius: 8px; padding: 20px; width: 31%; background-color: #f9f9f9; flex-grow: 1; }
        .answer-card h4 { margin-top: 0; color: #333; border-bottom: 2px solid #0056b3; padding-bottom: 10px; font-size: 1.1em; }
        .markdown-content { font-size: 1em; line-height: 1.6; }
        @media (max-width: 900px) {
            .answers-container { flex-direction: column; }
            .answer-card { width: 100%; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Model Answer Comparison</h1>
    <div class="tab lang-tab">
        <button class="tablinks" onclick="openLanguage(event, 'ko')" id="defaultOpen">Korean</button>
        <button class="tablinks" onclick="openLanguage(event, 'en')">English</button>
        <button class="tablinks" onclick="openLanguage(event, 'ja')">Japanese</button>
        <button class="tablinks" onclick="openLanguage(event, 'zh-Hant')">Traditional Chinese</button>
    </div>
    <div class="tab category-tab">
        <button class="category-tablinks" onclick="filterCategory(event, 'all')" id="defaultCategoryOpen">All</button>
        <button class="category-tablinks" onclick="filterCategory(event, 'general')">General Question</button>
        <button class="category-tablinks" onclick="filterCategory(event, 'exercise')">Exercise Question</button>
        <button class="category-tablinks" onclick="filterCategory(event, 'calculation')">Calculation Question</button>
    </div>
    <div id="ko" class="tabcontent"></div>
    <div id="en" class="tabcontent"></div>
    <div id="ja" class="tabcontent"></div>
    <div id="zh-Hant" class="tabcontent"></div>
</div>

<script>
    let allMergedData = {};
    let currentLanguage = 'ko';
    let currentCategory = 'all';

    function getCategory(id) {
        const num = parseInt(id.split('_')[1]);
        if (num >= 1 && num <= 50) return 'general';
        if (num >= 51 && num <= 100) return 'exercise';
        if (num >= 101 && num <= 125) return 'calculation';
        return 'unknown';
    }

    function displayData() {
        const tabcontent = document.getElementsByClassName("tabcontent");
        for (let i = 0; i < tabcontent.length; i++) {
            tabcontent[i].innerHTML = "";
            tabcontent[i].style.display = "none";
        }

        const targetTab = document.getElementById(currentLanguage);
        if (!targetTab) return;
        
        targetTab.style.display = "block";

        for (const id in allMergedData) {
            const data = allMergedData[id];
            const questionCategory = getCategory(id);

            if (data.language === currentLanguage && (currentCategory === 'all' || currentCategory === questionCategory)) {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';

                let answersHtml = '';
                for (const model in data.answers) {
                    answersHtml += `
                        <div class="answer-card">
                            <h4>${model}</h4>
                            <div class="markdown-content">${marked.parse(data.answers[model] || '')}</div>
                        </div>
                    `;
                }

                questionBlock.innerHTML = `
                    <h2 class="question-title">${id}:<br>${data.question}</h2>
                    <div class="answers-container">
                        ${answersHtml}
                    </div>
                `;
                targetTab.appendChild(questionBlock);
            }
        }
    }

    function openLanguage(evt, langName) {
        currentLanguage = langName;
        
        let i, tablinks;
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        evt.currentTarget.className += " active";
        
        displayData();
    }

    function filterCategory(evt, categoryName) {
        currentCategory = categoryName;

        let i, tablinks;
        tablinks = document.getElementsByClassName("category-tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        evt.currentTarget.className += " active";

        displayData();
    }

    async function loadData() {
        try {
            const modelFiles = ['gemma', 'qwen2.5', 'qwen3'];
            const fetchPromises = modelFiles.map(model => fetch(`final_data/QA_${model}.json`).then(res => res.json()));
            const allData = await Promise.all(fetchPromises);

            allData.forEach((modelData, index) => {
                const modelName = modelFiles[index];
                modelData.forEach(item => {
                    if (!allMergedData[item.id]) {
                        allMergedData[item.id] = {
                            question: item.question,
                            language: item.id.split('_')[0],
                            answers: {}
                        };
                    }
                    allMergedData[item.id].answers[modelName] = item.model_answer;
                });
            });
            
            document.getElementById("defaultOpen").click();
            document.getElementById("defaultCategoryOpen").click();

        } catch (error) {
            console.error("Error loading or processing data:", error);
            const container = document.querySelector('.container');
            container.innerHTML = '<h1>Error loading data</h1><p>Could not load comparison data. Please check the console for more details.</p>';
        }
    }

    window.onload = loadData;
</script>

</body>
</html>